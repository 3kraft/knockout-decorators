{"version":3,"file":null,"sources":["../src/knockout-decorators.ts"],"sourcesContent":["import * as ko from \"knockout\";\r\n\r\nexport interface ComponentConstructor {\r\n    new (\r\n        params?: any,\r\n        element?: Node,\r\n        templateNodes?: Node[]\r\n    ): any;\r\n}\r\n\r\nexport type ComponentDecorator = (constructor: ComponentConstructor) => void;\r\n\r\nexport type TemplateConfig = (\r\n    string\r\n    | Node[] \r\n    | DocumentFragment \r\n    | { require: string }\r\n    | { element: string | Node }\r\n);\r\n\r\nconst assign = ko.utils.extend;\r\nconst objectForEach = ko.utils.objectForEach;\r\nconst defProp = Object.defineProperty.bind(Object);\r\nconst getDescriptor = Object.getOwnPropertyDescriptor.bind(Object);\r\nconst slice = Function.prototype.call.bind(Array.prototype.slice);\r\n\r\n/**\r\n * Register Knockout component by decorating ViewModel class\r\n */\r\nexport function component(\r\n    name: string,\r\n    options?: Object\r\n): ComponentDecorator;\r\nexport function component(\r\n    name: string,\r\n    template: TemplateConfig,\r\n    options?: Object\r\n): ComponentDecorator;\r\nexport function component(\r\n    name: string,\r\n    template: TemplateConfig,\r\n    styles: string | string[],\r\n    options?: Object\r\n): ComponentDecorator;\r\n\r\n/**\r\n * Register Knockout component by decorating ViewModel class\r\n * @param name { String } Name of component\r\n * @param template { Any } Knockout template definition\r\n * @param styles { Any } Ignored parameter (used for `require()` styles by webpack etc.)\r\n * @param options { Object } Another options that passed directly to `ko.components.register()`\r\n */\r\nexport function component(\r\n    name: string,\r\n    template?: any,\r\n    styles?: any,\r\n    options?: Object\r\n) {\r\n    if (options === void 0) {\r\n        if (styles === void 0) {\r\n            if (typeof template === \"object\"\r\n                && template.constructor === Object\r\n                && !(\"require\" in template)\r\n                && !(\"element\" in template)\r\n            ) {\r\n                options = template;\r\n                template = void 0;\r\n            }\r\n        } else if (typeof styles === \"object\") {\r\n            options = styles;\r\n            styles = void 0;\r\n        }\r\n    }\r\n\r\n    return function (constructor: ComponentConstructor) {\r\n        ko.components.register(name, assign({\r\n            viewModel: constructor.length < 2 ? constructor : {\r\n                createViewModel(params, { element, templateNodes }) {\r\n                    return new constructor(params, element, templateNodes);\r\n                }\r\n            },\r\n            template: template || \"<!---->\",\r\n            synchronous: true,\r\n        }, options));\r\n    }\r\n}\r\n\r\nconst DECORATORS_KEY = typeof Symbol !== \"undefined\"\r\n    ? Symbol(\"ko_decorators\") : \"__ko_decorators_\";\r\n\r\nconst SUBSCRIPTIONS_KEY = typeof Symbol !== \"undefined\"\r\n    ? Symbol(\"ko_decorators_subscriptions\") : \"__ko_decorators_subscriptions_\";\r\n\r\nconst DISPOSABLE_KEY = typeof Symbol !== \"undefined\"\r\n    ? Symbol(\"ko_decorators_disposable\") : \"__ko_decorators_disposable_\";\r\n\r\nexport interface Disposable {\r\n    dispose(): void,\r\n}\r\n\r\nconst enum DecoratorType {\r\n    Extend, Subscribe,\r\n}\r\n\r\ninterface Decorator {\r\n    type: DecoratorType,\r\n    value: any,\r\n    event?: string,\r\n    dispose?: boolean,\r\n}\r\n\r\ninterface DecoratorsMetaData {\r\n    [propName: string]: Decorator[],\r\n}\r\n\r\nfunction getMetaData(prototype: Object) {\r\n    let metaData: DecoratorsMetaData = prototype[DECORATORS_KEY];\r\n    if (!prototype.hasOwnProperty(DECORATORS_KEY)) {\r\n        prototype[DECORATORS_KEY] = metaData = assign({}, metaData);\r\n        objectForEach(metaData, (key, decorators) => {\r\n            metaData[key] = [...decorators];\r\n        });\r\n    }\r\n    return metaData;\r\n}\r\n\r\nfunction getDecorators(metaData: DecoratorsMetaData, key: string | symbol) {\r\n    return metaData[key] || (metaData[key] = []);\r\n}\r\n\r\nfunction getSubscriptions(instance: Object): Disposable[] {\r\n    return instance[SUBSCRIPTIONS_KEY] || (instance[SUBSCRIPTIONS_KEY] = []);\r\n}\r\n\r\nfunction applyDecorators(\r\n    instance: Object, key: string | symbol,\r\n    target: ko.Observable<any> | ko.PureComputed<any>\r\n) {\r\n    const metaData: DecoratorsMetaData = instance[DECORATORS_KEY];\r\n    const decorators = metaData && metaData[key];\r\n    if (decorators) {\r\n        decorators.forEach(d => {\r\n            switch (d.type) {\r\n                case DecoratorType.Extend:\r\n                    const extenders = d.value instanceof Function\r\n                        ? d.value.call(instance) : d.value;\r\n                    target = target.extend(extenders);\r\n                    break;\r\n                case DecoratorType.Subscribe:\r\n                    const subscription = target.subscribe(d.value, instance, d.event);\r\n                    if (d.dispose) {\r\n                        getSubscriptions(instance).push(subscription);\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n    return target;\r\n}\r\n\r\nfunction redefineDispose(prototype: Object) {\r\n    if (prototype[DISPOSABLE_KEY]) { return; }\r\n    prototype[DISPOSABLE_KEY] = true;\r\n\r\n    const original = prototype[\"dispose\"];\r\n    prototype[\"dispose\"] = function dispose() {\r\n        const disposables = this[SUBSCRIPTIONS_KEY] as Disposable[];\r\n        if (disposables) {\r\n            disposables.forEach(s => { s.dispose(); });\r\n        }\r\n        if (original) {\r\n            return original.apply(this, arguments);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Property decorator that creates hidden ko.observable with ES6 getter and setter for it\r\n */\r\nexport function observable(prototype: Object, key: string | symbol) {\r\n    defProp(prototype, key, {\r\n        configurable: true,\r\n        get() {\r\n            const observable = applyDecorators(this, key, ko.observable());\r\n            defProp(this, key, {\r\n                configurable: true,\r\n                enumerable: true,\r\n                get: observable,\r\n                set: observable,\r\n            });\r\n            return observable();\r\n        },\r\n        set(value) {\r\n            const observable = applyDecorators(this, key, ko.observable());\r\n            defProp(this, key, {\r\n                configurable: true,\r\n                enumerable: true,\r\n                get: observable,\r\n                set: observable,\r\n            });\r\n            observable(value);\r\n        },\r\n    });\r\n}\r\n\r\ntype ObsArray = ko.ObservableArray<any> & { [fnName: string]: Function };\r\n\r\nconst arrayMethods = [\"pop\", \"push\", \"reverse\", \"shift\", \"sort\", \"splice\", \"unshift\"];\r\nconst observableArrayMethods = [\"remove\", \"removeAll\", \"destroy\", \"destroyAll\", \"replace\", \"subscribe\"];\r\n\r\nfunction defObservableArray(instance: Object, key: string | symbol) {\r\n    const obsArray = applyDecorators(instance, key, ko.observableArray()) as ObsArray;\r\n    \r\n    let insideObsArray = false;\r\n    defProp(instance, key, {\r\n        configurable: true,\r\n        enumerable: true,\r\n        get: obsArray,\r\n        set(array: any[]) {\r\n            if (array) {\r\n                arrayMethods.forEach(fnName => defProp(array, fnName, {\r\n                    configurable: true,\r\n                    value() {\r\n                        if (insideObsArray) {\r\n                            return Array.prototype[fnName].apply(array, arguments);\r\n                        }\r\n                        insideObsArray = true;\r\n                        const result = obsArray[fnName].apply(obsArray, arguments);\r\n                        insideObsArray = false;\r\n                        return result;\r\n                    }\r\n                }));\r\n                observableArrayMethods.forEach(fnName => defProp(array, fnName, {\r\n                    configurable: true,\r\n                    value() {\r\n                        insideObsArray = true;\r\n                        const result = obsArray[fnName].apply(obsArray, arguments);\r\n                        insideObsArray = false;\r\n                        return result;\r\n                    }\r\n                }));\r\n            }\r\n            insideObsArray = true;\r\n            obsArray(array);\r\n            insideObsArray = false;\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Property decorator that creates hidden ko.observableArray with ES6 getter and setter for it\r\n */\r\nexport function observableArray(prototype: Object, key: string | symbol) {\r\n    defProp(prototype, key, {\r\n        configurable: true,\r\n        get() {\r\n            defObservableArray(this, key);\r\n            return this[key];\r\n        },\r\n        set(value: any[]) {\r\n            defObservableArray(this, key);\r\n            return this[key] = value;\r\n        },\r\n    });\r\n}\r\n\r\nexport interface ObservableArray<T> extends Array<T> {\r\n    replace(oldItem: T, newItem: T): void;\r\n\r\n    remove(item: T): T[];\r\n    remove(removeFunction: (item: T) => boolean): T[];\r\n    \r\n    removeAll(): T[];\r\n    removeAll(items: T[]): T[];\r\n\r\n    destroy(item: T): void;\r\n    destroy(destroyFunction: (item: T) => boolean): void;\r\n    \r\n    destroyAll(): void;\r\n    destroyAll(items: T[]): void;\r\n\r\n    subscribe(callback: (val: T[]) => void): Disposable;\r\n    subscribe(callback: (val: T[]) => void, callbackTarget: any): Disposable;\r\n    subscribe(callback: (val: any[]) => void, callbackTarget: any, event: string): Disposable;\r\n}\r\n\r\n/**\r\n * Accessor decorator that wraps ES6 getter and setter to hidden ko.pureComputed\r\n */\r\nexport function computed(prototype: Object, key: string | symbol, desc: PropertyDescriptor) {\r\n    const { get, set } = desc || (desc = getDescriptor(prototype, key));\r\n    desc.get = function () {\r\n        const computed = ko.pureComputed(get, this);\r\n        defProp(this, key, {\r\n            configurable: true,\r\n            get: computed,\r\n            set: set\r\n        });\r\n        return computed();\r\n    };\r\n    return desc;\r\n    // TODO: make @computed extendable (by @extend decorator)\r\n}\r\n\r\n/**\r\n * Replace original method with factory that produces ko.computed from original method\r\n */\r\nexport function observer(autoDispose: boolean): MethodDecorator;\r\nexport function observer(prototype: Object, key: string | symbol, desc: PropertyDescriptor): PropertyDescriptor;\r\n\r\n/**\r\n * Replace original method with factory that produces ko.computed from original method\r\n * @param autoDispose { Boolean } if true then subscription will be disposed when entire ViewModel is disposed\r\n */\r\nexport function observer(\r\n    prototypeOrAutoDispose: Object | boolean, key?: string | symbol, desc?: PropertyDescriptor\r\n) {\r\n    let autoDispose: boolean;\r\n    if (typeof prototypeOrAutoDispose === \"boolean\" && key === void 0) {\r\n        autoDispose = prototypeOrAutoDispose;         // @observer(false)\r\n        return decorator;                             // onSomethingChange() {}\r\n    } else if (typeof prototypeOrAutoDispose === \"object\" && key !== void 0) {\r\n        autoDispose = true;                           // @observer\r\n        decorator(prototypeOrAutoDispose, key, desc); // onSomethingChange() {}\r\n    } else {\r\n        throw new Error(\"Can not use @observer decorator this way\");\r\n    }\r\n\r\n    function decorator(prototype: Object, key: string | symbol, desc: PropertyDescriptor) {\r\n        const { value } = desc || (desc = getDescriptor(prototype, key));\r\n        desc.value = function () {\r\n            const args = slice(arguments);\r\n            const computed = ko.computed(() => value.apply(this, args));\r\n            if (autoDispose) {\r\n                getSubscriptions(this).push(computed);\r\n            }\r\n            return computed;\r\n        };\r\n        if (autoDispose) {\r\n            redefineDispose(prototype);\r\n        }\r\n        return desc;\r\n    }\r\n}\r\n\r\n/**\r\n * Apply extenders to decorated @observable\r\n */\r\nexport function extend(extenders: Object): PropertyDecorator;\r\nexport function extend(extendersFactory: () => Object): PropertyDecorator;\r\n\r\n/**\r\n * Apply extenders to decorated @observable\r\n * @extendersOrFactory { Object | Function } Knockout extenders definition or factory that produces definition\r\n */\r\nexport function extend(extendersOrFactory: Object | Function) {\r\n    return function (prototype: Object, key: string | symbol) {\r\n        getDecorators(getMetaData(prototype), key).push({\r\n            type: DecoratorType.Extend,\r\n            value: extendersOrFactory,\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Subscribe to @observable by name or by specifying callback explicitely\r\n */\r\nexport function subscribe(callback: (value: any) => void, event?: string, autoDispose?: boolean): PropertyDecorator;\r\nexport function subscribe(targetOrCallback: string | symbol, event?: string, autoDispose?: boolean): PropertyDecorator;\r\nexport function subscribe(targetOrCallback: string | symbol, event?: string, autoDispose?: boolean): MethodDecorator;\r\n\r\n/**\r\n * Subscribe to @observable by name or by specifying callback explicitely\r\n * @param targetOrCallback { String | Function } name of callback or callback itself\r\n * when observable is decorated and name of observable property when callback is decorated\r\n * @param event { String } Knockout subscription event name\r\n * @param autoDispose { Boolean } if true then subscription will be disposed when entire ViewModel is disposed\r\n */\r\nexport function subscribe(\r\n    targetOrCallback: string | symbol | Function, event?: string, autoDispose = true\r\n) {\r\n    return function (prototype: Object, key: string | symbol, desc: PropertyDescriptor) {\r\n        const { value, get } = desc || (desc = getDescriptor(prototype, key));\r\n        let targetKey: string | symbol;\r\n        let callback: Function;\r\n        if (typeof value === \"function\") {\r\n            if (typeof targetOrCallback === \"string\" || typeof targetOrCallback === \"symbol\") {\r\n                targetKey = targetOrCallback;                   // @subscribe(\"target\")\r\n                callback = value;                               // callback(value) {}    \r\n            } else {\r\n                throw new Error(\"Subscription target should be a key in decorated ViewModel\");\r\n            }\r\n        } else if (typeof get === \"function\") {\r\n            if (typeof targetOrCallback === \"function\") {\r\n                targetKey = key;                                // @subscribe(ViewModel.prototype.callback)\r\n                callback = targetOrCallback;                    // @observable target;\r\n            } else if (typeof targetOrCallback === \"string\" || typeof targetOrCallback === \"symbol\") {\r\n                targetKey = key;                                // @subscribe(\"callback\")\r\n                callback = prototype[targetOrCallback];         // @observable target;\r\n            } else {\r\n                throw new Error(\"Subscription callback should be a function or key in decorated ViewModel\");\r\n            }\r\n        }\r\n        getDecorators(getMetaData(prototype), targetKey).push({\r\n            type: DecoratorType.Subscribe,\r\n            value: callback,\r\n            event: event,\r\n            dispose: autoDispose,\r\n        });\r\n        if (autoDispose) {\r\n            redefineDispose(prototype);\r\n        }\r\n        return desc as any;\r\n    }\r\n}\r\n\r\n/**\r\n * Like https://github.com/jayphelps/core-decorators.js @autobind but less smart and complex\r\n * Do NOT use with ES6 inheritance!\r\n */\r\nexport function autobind(prototype: Object, key: string | symbol, desc: PropertyDescriptor) {\r\n    const { value, configurable, enumerable } = desc || (desc = getDescriptor(prototype, key));\r\n    return {\r\n        configurable: configurable,\r\n        enumerable: enumerable,\r\n        get() {\r\n            if (this === prototype) {\r\n                return value;\r\n            }\r\n            const bound = value.bind(this);\r\n            defProp(this, key, {\r\n                configurable: true,\r\n                value: bound,\r\n            });\r\n            return bound;\r\n        }\r\n    } as PropertyDescriptor;\r\n}"],"names":[],"mappings":"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"}