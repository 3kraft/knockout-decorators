{"version":3,"file":null,"sources":["../src/knockout-decorators.ts"],"sourcesContent":["import * as ko from \"knockout\";\r\n\r\nexport interface ComponentConstructor {\r\n    new (\r\n        params?: any,\r\n        element?: Node,\r\n        templateNodes?: Node[]\r\n    ): any;\r\n}\r\n\r\nexport type ComponentDecorator = (constructor: ComponentConstructor) => void;\r\n\r\nexport type TemplateConfig = (\r\n    string\r\n    | Node[] \r\n    | DocumentFragment \r\n    | { require: string }\r\n    | { element: string | Node }\r\n);\r\n\r\nconst extend = ko.utils.extend;\r\n\r\n/**\r\n * Register Knockout component by decorating ViewModel class\r\n */\r\nexport function component(\r\n    name: string,\r\n    options?: Object\r\n): ComponentDecorator;\r\nexport function component(\r\n    name: string,\r\n    template: TemplateConfig,\r\n    options?: Object\r\n): ComponentDecorator;\r\nexport function component(\r\n    name: string,\r\n    template: TemplateConfig,\r\n    styles: string | string[],\r\n    options?: Object\r\n): ComponentDecorator;\r\n\r\n/**\r\n * Register Knockout component by decorating ViewModel class\r\n */\r\nexport function component(\r\n    name: string,\r\n    template?: any,\r\n    styles?: any,\r\n    options?: Object\r\n) {\r\n    if (options === void 0) {\r\n        if (styles === void 0) {\r\n            if (typeof template === \"object\"\r\n                && template.constructor === Object\r\n                && !(\"require\" in template)\r\n                && !(\"element\" in template)\r\n            ) {\r\n                options = template;\r\n                template = void 0;\r\n            }\r\n        } else if (typeof styles === \"object\") {\r\n            options = styles;\r\n            styles = void 0;\r\n        }\r\n    }\r\n\r\n    return function (constructor: ComponentConstructor) {\r\n        ko.components.register(name, extend({\r\n            viewModel: constructor.length < 2 ? constructor : {\r\n                createViewModel(params, { element, templateNodes }) {\r\n                    return new constructor(params, element, templateNodes);\r\n                }\r\n            },\r\n            template: template || \"<!---->\",\r\n            synchronous: true,\r\n        }, options));\r\n    }\r\n}\r\n\r\nconst defProp = Object.defineProperty.bind(Object);\r\n\r\n/**\r\n * Property decorator that creates hidden ko.observable with ES6 getter and setter for it\r\n */\r\nexport function observable(target: Object, key: string | symbol) {\r\n    defProp(target, key, {\r\n        get() {\r\n            const observable = ko.observable();\r\n            defProp(this, key, {\r\n                get() { return observable(); },\r\n                set(value) { observable(value); },\r\n            });\r\n            return observable();\r\n        },\r\n        set(value) {\r\n            const observable = ko.observable(value);\r\n            defProp(this, key, {\r\n                get() { return observable(); },\r\n                set(value) { observable(value); },\r\n            });\r\n        },\r\n    });\r\n}\r\n\r\n/**\r\n * Accessor decorator that wraps ES6 getter and setter to hidden ko.pureComputed\r\n */\r\nexport function computed(target: Object, key: string | symbol) {\r\n    const { get, set } = Object.getOwnPropertyDescriptor(target, key);\r\n    if (!set) {\r\n        defProp(target, key, {\r\n            get() {\r\n                const computed = ko.pureComputed(get, this);\r\n                defProp(this, key, {\r\n                    get() { return computed(); }\r\n                });\r\n                return computed();\r\n            }\r\n        });\r\n    } else {\r\n        defProp(target, key, {\r\n            get() {\r\n                const computed = ko.pureComputed({\r\n                    read: get,\r\n                    write: set,\r\n                    owner: this,\r\n                });\r\n                defProp(this, key, {\r\n                    get() { return computed(); },\r\n                    set(value) { computed(value); },\r\n                });\r\n                return computed();\r\n            },\r\n            set(value) {\r\n                const computed = ko.pureComputed({\r\n                    read: get,\r\n                    write: set,\r\n                    owner: this,\r\n                });\r\n                defProp(this, key, {\r\n                    get() { return computed(); },\r\n                    set(value) { computed(value); },\r\n                });\r\n                computed(value);\r\n            },\r\n        });\r\n    }\r\n}"],"names":[],"mappings":"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"}